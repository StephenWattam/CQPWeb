<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.1  (Unix)">
	<META NAME="AUTHOR" CONTENT="Andrew Hardie">
	<META NAME="CREATED" CONTENT="20090607;11102800">
	<META NAME="CHANGEDBY" CONTENT="Andrew Hardie">
	<META NAME="CHANGED" CONTENT="20091210;6283500">
	<META NAME="Info 1" CONTENT="">
	<META NAME="Info 2" CONTENT="">
	<META NAME="Info 3" CONTENT="">
	<META NAME="Info 4" CONTENT="">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1 LANG="en-GB">Some very quick notes on how to set up CQPweb v 2.03
or higher</H1>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>What
you will need</B></FONT></FONT></P>
<P LANG="en-GB">You'll need a machine with a Unix-style operating
system (<I>CQPweb has been tested, so far, on Sun OS 5.10; Debian;
Ubuntu; and Fedora</I>). Other software you need: 
</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Apache or some other webserver (note: <I>internal
	username/password functions assume you are using Apache, if not </I><I><B>you
	will have to manage your own user accounts and passwords</B></I>) 
	</P>
	<UL>
		<LI><P LANG="en-GB">(I run it with Apache 2 but Apache 1 would
		probably work as well…) 
		</P>
	</UL>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">MySQL (v5.0 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">PHP (v5 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Perl (v5.8 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">And of course CWB (the version distributed
	alongside BNCweb, or a more recent version from the SourceForge SVN
	tree; see also below) .</P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up Apache</B></FONT></FONT></P>
<P LANG="en-GB">This section assumes that you are using Apache and
that you want to use the internal username/password functions in
CQPweb. If this assumption is false, skip onwards to the next
section!</P>
<P LANG="en-GB">Make sure that your Apache configuration file is set
up to allow <B>.htaccess</B> files in the CQPweb web-directory. The
directive 
</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AllowOverride
None</B></FONT></FONT></FONT></P>
<P LANG="en-GB">sometimes appears by default in apache config files.
Change it to</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AllowOverride
All</B></FONT></FONT></FONT></P>
<P LANG="en-GB"><I>for the site or directory which contains the
CQPweb web-directory</I>. Depending on how your Apache config files
are set up, this might be set overall for the server (in
<FONT FACE="Courier New, monospace">/etc/apache2/apache2.conf</FONT>);
or for the particular host (in
<FONT FACE="Courier New, monospace">/etc/apache2/sites-available/{$site}.conf</FONT>).</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up the Perl elements</B></FONT></FONT></P>
<P LANG="en-GB">You will need to install the following Perl modules
from the CWB Perl distribution:</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">The CWB.pm module</P>
	<LI><P LANG="en-GB">The CEQL.pm module that forms part of it. 
	</P>
	<LI><P LANG="en-GB"><I>However, it is most convenient to install the
	entire set of modules from CWB Perl, rather than just these files.</I></P>
</UL>
<P LANG="en-GB">Use the version of CWB.pm distributed alongside
BNCweb v 4.2 – this is v3.0 of cwb-perl-lib.</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">The Perl module files should be copied into a
	directory on Perl's @INC path, such as
	<FONT FACE="Courier New, monospace">/usr/local/lib/perl/{$version}/</FONT>
	or <FONT FACE="Courier New, monospace">/usr/lib/perl5/{$version}/</FONT>
	, depending on the details of how Perl is set up on your system.</P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up MySQL</B></FONT></FONT></P>
<P LANG="en-GB">You will need to create a new user and a new database
for CQPweb to use.</P>
<P LANG="en-GB">Make a note of the username / password of this new
user and of the new database.</P>
<P LANG="en-GB"><SPAN LANG="en-GB">The new database should have
</SPAN><SPAN LANG="en-GB"><B>default charset</B></SPAN><SPAN LANG="en-GB">
set to </SPAN><SPAN LANG="en-GB"><B>utf8.</B></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-weight: normal">This
addresses a bug which affects some (but not all!) versions of the
MySQL server software – see <A HREF="http://bugs.mysql.com/bug.php?id=10195">http://bugs.mysql.com/bug.php?id=10195</A></SPAN></SPAN></P>
<P LANG="en-GB">The new user needs to have <FONT FACE="Courier New, monospace">GRANT
ALL</FONT> on the new database. If you want MySQL to use file-access
functions (this is not necessary, but may speed things up; see
below), the new user also needs <FONT FACE="Courier New, monospace">GRANT
FILE ON *.*</FONT></P>
<P LANG="en-GB">Also make a note of the servername needed to access
the MySQL server by a webscript. This will probably be <FONT FACE="Courier New, monospace">localhost</FONT>,
assuming that the MySQL server is on the same machine as the
webscripts. (It does not absolutely need to be.)</P>
<P LANG="en-GB">A known “gotcha”: PHP needs to know how to
connect to the MySQL server via a <I>socket</I> in the filesystem.
This information is often contained in the <FONT FACE="Courier New, monospace">php.ini</FONT>
file, which contains settings loaded by PHP when it starts up. On
many systems, connecting to MySQL simply “works” by default, but
on some systems you may need to edit your <FONT FACE="Courier New, monospace">php.ini</FONT>
file to tell PHP where to find the socket, by changing the
<FONT FACE="Courier New, monospace">mysql.default_socket</FONT>
setting. For instance, if your socket is at <FONT FACE="Courier New, monospace">/tmp/mysql.sock
</FONT>but PHP is looking at <FONT FACE="Courier New, monospace">/var/mysql/mysql.sock</FONT>
, you need to adjust <FONT FACE="Courier New, monospace">mysql.default_socket</FONT>
to /tmp/mysql.sock. If you edit a <FONT FACE="Courier New, monospace">php.ini</FONT>
file, make sure it is the one used when PHP is run by the server
(i.e. as CGI or as an Apache module).</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up directories</B></FONT></FONT></P>
<P LANG="en-GB">CQPweb needs the following directories to be created
on the server.</P>
<TABLE WIDTH=882 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=556>
	<COL WIDTH=309>
	<TR VALIGN=TOP>
		<TD WIDTH=556 BGCOLOR="#c0c0c0">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><B>Create
			a directory for…</B></FONT></FONT></FONT></P>
		</TD>
		<TD WIDTH=309 BGCOLOR="#c0c0c0">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><B>Where
			it should be</B></FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>The
				actual web scripts<BR>(NB the URL of this directory will become
				the base URL for your CQPweb system) </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			in the web-docs directory of the server</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL START=2>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>CQPweb’s
				web usernames and passwords </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL START=3>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Temporary
				files (inc the cache) </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL START=4>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Indexed
				corpora </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL START=5>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Registry
				files for indexed corpora </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556>
			<OL START=6>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Upload
				area for files put onto the server via HTTP </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309>
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB">… <SPAN LANG="en-GB">make a note of the path of
each one. </SPAN>
</P>
<P LANG="en-GB">Note that the data / registry locations do not need
to be the same as the ones you normally use for CWB.</P>
<P LANG="en-GB">The username of the webserver (in the case of Apache,
usually something like <B>www</B> or <B>www-data</B>) need to have
read-write-execute access to all these directories. The username of
the mysqld process (usually something like <B>mysql</B><SPAN STYLE="font-weight: normal">)
also needs read and write access if you want MySQL to use file-access
functions. So, these new folders </SPAN><I><SPAN STYLE="font-weight: normal">must</SPAN></I>
<SPAN STYLE="font-weight: normal">have the write permission set for
either “all” or – if you are worried about security – for
“group” (where the file is assigned to some group that both the
mysql server's account and the web server's account belong to).</SPAN></P>
<P LANG="en-GB"><I><SPAN STYLE="font-weight: normal">Sidenote for
Unix novices</SPAN></I><SPAN STYLE="font-weight: normal">: the easy
way to find out what the username of these two server programs is
with commands like these – the first word on the output line is the
username you want</SPAN></P>
<UL>
	<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">ps
	-e -o user,comm | grep mysqld </FONT>
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">ps
	-e -o user,comm | grep apache2 </SPAN><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">or
	whatever the name of the web server program is</SPAN></FONT></FONT></P>
</UL>
<P LANG="en-GB"><FONT FACE="Courier New, monospace"><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">A
“gotcha” can occur here in systems that have AppArmor (for
example, recent versions of Ubuntu). AppArmor allows/disallows file
access to individual programs; if it does not allow mysqld access to
these new directories, you will not be able to run CQPweb
successfully, </SPAN></FONT><FONT FACE="Times New Roman, serif"><I><SPAN STYLE="font-weight: normal">even
if</SPAN></I></FONT> <FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">the
</SPAN></FONT><FONT FACE="Times New Roman, serif"><B>mysql</B></FONT>
<FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">username
has full permissions. You fix this by doing the following (as root):</SPAN></FONT></FONT></P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">edit
	</SPAN></FONT><SPAN STYLE="font-weight: normal">/etc/apparmor.d/usr.sbin.mysqld</SPAN>
	<FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">and
	add a line like this before the closing brace for each CQPweb
	directory:</SPAN></FONT></FONT></P>
	<UL>
		<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">/path/to/the/directory/in/question/**
		rw,</FONT></P>
	</UL>
	<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Times New Roman, serif">Then
	restart AppArmor:</FONT></P>
	<UL>
		<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">/etc/init.d/apparmor
		restart</FONT></P>
	</UL>
</UL>
<P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Times New Roman, serif">The
alternative is to disable AppArmor completely.</FONT></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up the web scripts</B></FONT></FONT></P>
<P LANG="en-GB">Copy the contents of the CQPweb <B>.tar.gz</B>
distribution file to the web directory you created above (such that
the directories <B>lib</B>, <B>adm</B> etc. appear directly within
this web-directory). Don’t change the folder hierarchy. Make sure
the www user has rwx access to all the files you’ve just put in
here.</P>
<P LANG="en-GB">Alternatively, use subversion to get the most
up-to-date version of the code:</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">svn co
	http://cwb.svn.sourceforge.net/viewvc/cwb/gui/cqpweb/trunk cqpweb</FONT></P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
a config file: automatically</B></FONT></FONT></P>
<P LANG="en-GB">There is now an auto-config script – it is somewhat
primitive but it will save you fiddling with PHP code for
configuration variables. To use it, change directory to the web
directory, and run</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">php
	cqpweb-autoconfig.php</FONT></P>
</UL>
<P LANG="en-GB">… <SPAN LANG="en-GB">and follow the instructions to
enter the paths and other info that you made a note of above.</SPAN></P>
<P LANG="en-GB">When you are asked to specify admin usernames, enter
at least one username (the one you will use). Its password is
initially set to the same as the username, you should change this as
soon as possible.</P>
<P LANG="en-GB">Note that the script's last action is to gzip itself
to avoid accidentally running again. Before you take the system live,
you should <B>delete this script</B> – <SPAN STYLE="font-weight: normal">as
it could compromise the security of the system. (When you use the
“restore default system security” option, one of the various
things it does is check that this script is gone – in both its
gzipped and non-gzipped forms – and delete it if not.)</SPAN></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
a config file: manually</B></FONT></FONT></P>
<P LANG="en-GB">If you configure CQPweb manually, you need to
actually edit the code file that contains the config variables. Do
this as follows: 
</P>
<P LANG="en-GB">Find the file called “template.config.inc.php”
and edit it. It looks like this:</P>
<TABLE WIDTH=1012 BORDER=1 CELLPADDING=4 CELLSPACING=3>
	<COL WIDTH=996>
	<TR>
		<TD WIDTH=996 VALIGN=TOP>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>&lt;?php</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			SYSTEM CONFIG SETTINGS : the same for every corpus, and CANNOT be
			overridden */<BR>/* these settings should never be alterable from
			within CQPweb (would risk transmitting them as plaintext) */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			adminstrators' usernames, separated by | (as in BNCweb) */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$superuser_username
			= 'bob|jeff';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			mySQL username and password */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_webuser
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_webpass
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_schema
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_server
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			---------------------- */<BR>/* server directory paths */<BR>/*
			---------------------- */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_cwb
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_apache_utils
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_perl
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_tempdir
			= '3';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_accessdir
			= '2';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_uploaddir
			= '6';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cwb_datadir
			= '4';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cwb_registry
			= '5';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			if mySQL returns ???? instead of proper UTF-8 symbols, change this
			setting true -&gt; false or false -&gt; true */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$utf8_set_required
			= true;</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>?&gt;</FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$superuser_username</FONT>
variable is a string that should contain the usernames who are to be
administrators, separated by the pipe <FONT FACE="Courier New, monospace">|</FONT>.
You can have as many superusers as you like, but you must have at
least one.</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$mysql_</FONT>
settings are the things you noted when creating the mysql user.</P>
<P LANG="en-GB">The last five settings are the directories you
created (<I><B>numbers shown in the example correspond to the table
above</B></I>).</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$path_to</FONT>
settings specify where the perl, cwb and apache utilities binaries
are to be found. Give them in the following format (example paths
from a linux server):</P>
<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_cwb
= 'usr/local/bin';<BR>$path_to_apache_utils =
'usr/local/bin';<BR>$path_to_perl = 'usr/bin';</FONT></FONT></P>
<P LANG="en-GB">Note in particular: there IS NOT a slash at the
beginning or end of any of these three paths.</P>
<P LANG="en-GB">You are recommended to start with <FONT FACE="Courier New"><FONT SIZE=2><SPAN LANG="en-US">$utf8_set_required
= true;</SPAN></FONT></FONT> and see if it causes a problem – and
change it if so.</P>
<P LANG="en-GB">There are assorted settings that can be set manually,
but not automatically. They are</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$use_corpus_categories_on_homepage</FONT>
	– this defaults to <B>false,</B> if you set it to <B>true</B> <SPAN STYLE="font-weight: normal">then
	the main menu of corpora will be given as a set of lists according
	to the corpus category, rather than as a single long list of
	corpora.</SPAN></P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">$create_password_function</SPAN></FONT>
	– <SPAN STYLE="font-weight: normal">CQPweb uses “suggest
	password” functions to ease the creation of user accounts. The
	default function (</SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">password_insert_internal</SPAN></FONT><SPAN STYLE="font-weight: normal">)
	produces passwords of the form </SPAN><B>aaaaddaaaa</B> <SPAN STYLE="font-weight: normal">where
	</SPAN><B>a</B> <SPAN STYLE="font-weight: normal">is a lowercase
	letter and </SPAN><B>d</B> <SPAN STYLE="font-weight: normal">is a
	digit. You can optionally use Lancaster University's random password
	generator to get nicer, more-wordlike passwords: to do this, set the
	</SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">$create_password_function</SPAN></FONT>
	<SPAN STYLE="font-weight: normal">to the quoted string
	</SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">'password_insert_lancaster'</SPAN></FONT><SPAN STYLE="font-weight: normal">.
	</SPAN>
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$mysql_has_file_access</FONT>
	– this defaults to false, if you set it to true then this affects
	various functions that load data from file to the MySQL server: they
	may run faster. But this must only be set to true <B>if</B> (a) the
	MySQL server is running on the same computer as CQPweb <B>and</B>
	(b) the MySQL server actually does have access to the temporary
	directory <B>and</B> (c) the MySQL username used by CQPweb has <FONT FACE="Courier New, monospace">GRANT
	FILE ON *.*</FONT> permissions. It is important you get this right,
	as CQPweb doesn't check these preconditions for you! 
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$cqpweb_uses_apache</FONT>
	– this defaults to true, but you can set it to false if your web
	server is not Apache. If it is set to false, functions that depend
	on Apache will be hidden (since they wouldn't work anyway).</P>
</UL>
<P LANG="en-GB">Save the edited file as “config.inc.php” and put
it into the “lib” subdirectory of the web directory.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up administrator users</B></FONT></FONT></P>
<P LANG="en-GB"><I><U>If you have used the autoconfig, then this is
done automatically for you.</U></I> Otherwise...</P>
<P LANG="en-GB">Using a text editor, create a file called <B>.htgroup</B>
in directory (2) as described above. It should look like this:</P>
<P LANG="en-GB" ALIGN=LEFT><FONT FACE="Courier New"><B>superusers:
bob jeff</B></FONT></P>
<P LANG="en-GB">but with the usernames changed to match the ones in
your configuration file. Once CQPweb is up and running, use the
“create user / reset password” function to actually create the
accounts (see below).</P>
<P LANG="en-GB">You'll also need to create a <B>.htaccess</B> file
for the <B>./adm</B> directory. It should look like this:</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AuthUserFile
/<FONT COLOR="#800000">$cqpweb_accessdir</FONT>/.htpasswd<BR>AuthGroupFile
/<FONT COLOR="#800000">$cqpweb_accessdir</FONT>/.htgroup<BR>AuthName
CQPweb<BR>AuthType Basic<BR>deny from all<BR>require group
superusers<BR>satisfy any</B></FONT></FONT></FONT></P>
<P LANG="en-GB">… <SPAN LANG="en-GB">but with the appropriate
directories substituted, as in the configuration file.</SPAN></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Getting
it up and running</B></FONT></FONT></P>
<P LANG="en-GB">You are now ready to go. Open a web browser and
navigate to 
</P>
<P LANG="en-GB"><FONT FACE="Courier New, monospace"><B>http://your-server.net/path/to/cqpweb/web/directory/adm</B></FONT></P>
<P LANG="en-GB">(the “adm” is short for Admin).</P>
<P LANG="en-GB">You should see an admin menu. 
</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “manage users”. Create usernames
	for AT LEAST the superusers (<I><B>if you used the autoconfig
	script, this has been done for you already, but you will need to
	reset the passwords at some point</B></I>). You can add other user
	accounts later. 
	</P>
	<LI><P LANG="en-GB">Click on “Reset MySQL Database” – and do
	it 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “System security” – and restore
	default security. (Only do this if you are using Apache) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “Skins and colours” – and
	“Regenerate colour schemes” 
	</P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
usernames</B></FONT></FONT></P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Use “manage users” for this.</P>
	<LI><P LANG="en-GB">CQPweb gives access to corpora to groups of
	users, not individual usernames. This is done through the “manage
	access” link for each corpus: find this on the “show corpora”
	item of the admin menu.</P>
	<LI><P LANG="en-GB">A user can be assigned to as many groups as you
	like. Use “Manage groups” for this. 
	</P>
</UL>
<P LANG="en-GB">CQPweb passwords are transmitted in plaintext via
HTTP. <B>User accounts are thus not secure</B>, the security is all
based on the fact that even if someone manages to hack in, they can’t
do anything other than break CQPweb itself. For this reason, I
usually select passwords for my users, to make sure that they don’t
re-use on CQPweb the secure passwords that they use for other
purposes. If you really want secure username/password access, you
need to set up CQPweb on an HTTPS server.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Installing
a corpus</B></FONT></FONT></P>
<P LANG="en-GB">Corpora must follow all the usual rules for CWB
corpora and in addition there is the following requirement:</P>
<P LANG="en-GB">Every text in the corpus must begin with</P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">&lt;text
id=&quot;XXX&quot;&gt;</FONT></P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">...</FONT></P>
<P LANG="en-GB">and end with</P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">&lt;/text&gt;</FONT></P>
<P LANG="en-GB">and there must be at least one of these “text”
elements (ie if the whole corpus is one text you still need these XML
bits at the start and finish).</P>
<P LANG="en-GB">The XXX id-codes must be C / Unix words – i.e. made
up only of the letters A to Z, a to z, the numbers 0 to 9, and the
underscore (with an underscore or letter in the first position). This
is because they are used as “handles” by the system to refer to
different texts. So no spaces or punctuation (except underscore) are
allowed.</P>
<P LANG="en-GB">To install a corpus, you need:</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">A file or files containing the corpus text, as
	above 
	</P>
	<LI><P LANG="en-GB">A file of corpus metadata. 
	</P>
</UL>
<P LANG="en-GB">The metadata file should be a tab-delimited database.
The first column should be the text id-codes, with a line for each
text. You can then have as many columns of metadata as you need.</P>
<P LANG="en-GB">Metadata is of two sorts – classifications and free
text</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Free text – for items where the metadata can
	vary across every single text (e.g. text title) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Classifications – for items where each text
	falls into one of a limited number of categories (e.g. written vs
	spoken) In this case the field values must be handles (Unix words as
	described above), NOT multi-word explanations 
	</P>
</UL>
<P LANG="en-GB">All files must be either ASCII or UTF-8. If they are
UTF-8, the file must <U><B>not</B></U> have a leading byte-order
mark. Linebreaks should be \n , not \r or \r\n .</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Upload all your files (text + metadata) to the
	upload area (directory 6). Then go to “Install new corpus” in
	the web admin interface. This form is pretty self-explanatory if you
	know CWB, but note the following: 
	</P>
	<LI><P LANG="en-GB">There is a bug in CQPweb just now that creates
	problems if the MySQL name and the CWB name are not the same. Again,
	these are handles, so use Unix words. 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">CQPweb’s default P-attribute setup assumes
	texts have Lancaster University's default annotation set, encoded
	like the BNC (a future version of this documentation will contain
	more details and examples). But you can use any number or kind of
	tags, or none. If you have annotations you need to set one as
	primary – this would usually be POS tag. 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Again each annotation column must have a Unix
	word as its handle. 
	</P>
	<UL>
		<LI><P LANG="en-GB">After your corpus is installed, you will need
		to set up the interaction with CEQL on the “Manage annotation”
		page – where annotations are referred to using these handles. See
		below</P>
	</UL>
</UL>
<P LANG="en-GB">When you have installed your corpus, you will need to
fill in a form describing the metadata table, which is then loaded.</P>
<P LANG="en-GB">Each field must have a handle, and you must specify
whether it is a classification or not.</P>
<P LANG="en-GB">Once the metadata table is loaded, you will be on a
page called “<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><SPAN STYLE="font-style: normal"><B>Admin
tools for managing corpus metadata</B></SPAN></FONT></FONT></FONT> ”.
Click each of the buttons on this page, working from the bottom up
(and press “back” once the operation has completed to press the
next button). <I>On corpora which are just one long text, “Create
CWB frequency table” is unnecessary and, indeed, may not work</I>.</P>
<P LANG="en-GB">The next (optional) step is to set up the interaction
of your annotation with the CEQL Simple Query Parser. Click on
“Manage Annotation” for this. The primary annotation will already
be set up – it is accessed by putting the tag you want to search
for after an underscore in Simple Query (like POS tags in BNCweb).
But if you want to use CEQL to access other p-attributes, you need to
set this up here.</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">The <B>secondary</B> annotation is just another
	column like the primary annotation, accessed in CEQL by putting what
	you want to search for in {braces}. Typically you'd put a “headword”
	i.e. lemma here.</P>
	<LI><P LANG="en-GB">The <B>tertiary</B> annotation is a bit
	different. It accesses a third field, via
	_{braces-with-leading-underscore}, but i<U>t also requires a mapping
	table</U> as it is possible to set up multiple aliases for a single
	tag. This is meant to support “simplified” POS tags like the
	Oxford Simplified Tagset used in the BNC. For example, the tag SUBST
	is used for nouns in the OST; but the aliases N and NOUN are set up
	for this tag in the mapping table – the idea being to make access
	to the simple tagsets more intuitive. Currently, mapping tables are
	built into the CQPweb code (in <FONT FACE="Courier New, monospace">ceql.inc.php</FONT>
	if you want to do some hacking).</P>
	<LI><P LANG="en-GB">The <B>combination</B> annotation is for a type
	of accelerated query. Due to the way CQP works, it is quicker to
	query one p-attribute than two, especially in very big corpora. So,
	to make the querying of lemma-plus-pos quicker, in BNC-style index
	formats an extra p-attribute is added, consisting of the headword
	(hw) and simple POS (class) attributes joined by an underscore. This
	combined p-attribute is called “lemma” in the terminology of BNC
	annotation.<BR><BR>If you have a combination attribute in your
	corpus like this, then identifying it here will allow you to access
	it via searches of the type {.../...}. If you <I>don't</I> have a
	combination annotation, then searches of this type will convert
	automatically to search the secondary and tertiary annotations at
	the same time: i.e. {aaa/bbb} becomes the same as {aaa}_{bbb} –
	<I><U>but note this back-up behaviour is currently buggy in the
	CQPweb implementation of CEQL</U></I>.<BR><BR>The second half of the
	combination annotation uses the same mapping table as the tertiary
	annotation.</P>
	<LI><P LANG="en-GB">Annotations that are not accessible via CEQL can
	still be accessed using the full CQP syntax.</P>
</UL>
<P LANG="en-GB">You are now ready to go – point your browser at
<B>http://your-server.net/path/to/cqpweb/web/directory</B> and you’re
off.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Using
CQPweb with a web server other than Apache</B></FONT></FONT></P>
<P LANG="en-GB">CQPweb can be used with web servers other than
Apache. However, you will not be able to use the internal
user-creation, group-management, and access-management functions,
because these are all dependent on Apache htaccess, htpasswd and
htgroup files (and the information is not stored in the database).
CQPweb on its own does nothing to restrict access to a corpus to
particular users: this job belongs to the web server. 
</P>
<P LANG="en-GB">CQPweb does store some information about users in its
database – notably, the “limits” of how big each individual use
of the database can be, and the personalisable “settings” that
affect the default behaviour of CQPweb. For both these purposes,
CQPweb gets the username from the HTTP request (PHP variable
<FONT FACE="Courier New, monospace">$_SERVER['REMOTE_USER']</FONT> ).
User entries in the database are created automatically when they
change their settings (or with default settings when any script
queries a user setting before they have been set.) So, any HTTP
server system that results in the username being part of the HTTP
request can be used with CQPweb.</P>
<P LANG="en-GB">CQPweb puts each corpus in a separate directory in
its root web-directory, so that you can set access rights for each
corpus separately, if you wish. But if you are no using Apache, <I>you
will have to manage this yourself</I>. 
</P>
<P LANG="en-GB">With Apache, this works as follows: (a) the
web-folder of each corpus has an .htaccess file in which are listed
the groups that have access to that corpus; (b) the list of members
in each group is in the .htgroup file in CQPweb's “access”
directory (and the .htpasswd file is there as well). How exactly you
simulate this will depend on the details of the alternative web
server you are using.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Using
a separate computer for MySQL </B></FONT></FONT>
</P>
<P LANG="en-GB">You might want to use two separate machines for the
CWB-based and MySQL-based parts of CQPweb, for reasons of performance
(for a big corpus and for queries with lots of results, both MySQL
and CWB require lots of disk space and lots of processing power). 
</P>
<P LANG="en-GB">In this case, CQPweb itself (the web scripts) should
be on the same system as CWB, and all the paths specified in the
config file should refer to <I>that</I> file-system, <I>not</I> the
one with MySQL on it.</P>
<P LANG="en-GB">You <I>must not</I> set <FONT FACE="Courier New, monospace">$mysql_has_file_access</FONT>
to <B>true</B> if the MySQL server is on a separate computer. The
system cannot currently check this for you!</P>
<P LANG="en-GB"><BR><BR>
</P>
<HR>
<P LANG="en-GB"><FONT COLOR="#808080"><FONT FACE="verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">CQPweb
v2.02 © 2008-2009 – documentation by Andrew Hardie,
<A HREF="mailto:andrewhardie@sourceforge.net">andrewhardie@sourceforge.net</A>
</SPAN></SPAN></SPAN></FONT></FONT></FONT>
</P>
</BODY>
</HTML>