<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.2  (Unix)">
	<META NAME="AUTHOR" CONTENT="Andrew Hardie">
	<META NAME="CREATED" CONTENT="20090607;11102800">
	<META NAME="CHANGEDBY" CONTENT="Andrew Hardie">
	<META NAME="CHANGED" CONTENT="20101101;6054000">
	<META NAME="Info 1" CONTENT="">
	<META NAME="Info 2" CONTENT="">
	<META NAME="Info 3" CONTENT="">
	<META NAME="Info 4" CONTENT="">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1 LANG="en-GB">Some notes on how to set up CQPweb (v 2.13 or
higher)</H1>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>What
you will need</B></FONT></FONT></P>
<P LANG="en-GB">You'll need a machine with a Unix-style operating
system (<I>CQPweb has been tested, so far, on Mac OS X; Sun OS 5.10;
Debian; Ubuntu; and Fedora</I>). Other software you need to have
installed: 
</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Apache or some other webserver (note: <I>internal
	username/password functions assume you are using Apache, if not </I><I><B>you
	will have to manage your own user accounts and passwords</B></I>) 
	</P>
	<UL>
		<LI><P LANG="en-GB">(I run it with Apache 2 but Apache 1 would
		probably work as well…) 
		</P>
	</UL>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">MySQL (v5.0 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">PHP (v5 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Perl (v5.8 or higher) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Open Corpus Workbench (at least version 3.2.0 if
	you want UTF8 regular expression matching, otherwise at least
	2.2.100)</P>
	<UL>
		<LI><P LANG="en-GB"><SPAN LANG="en-GB">See
		<A HREF="http://cwb.sourceforge.net/">http://cwb.sourceforge.net</A></SPAN></P>
	</UL>
	<LI><P LANG="en-GB">Standard Unix-style command-line tools: awk,
	tar, and gzip</P>
	<UL>
		<LI><P LANG="en-GB">Awk: any version of awk compatible with GNU awk
		(“gawk”) should be OK</P>
	</UL>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Hardware</B></FONT></FONT>
<FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>requirements</B></FONT></FONT></P>
<P LANG="en-GB">It is difficult to generalise about what hardware you
will need. Even a (relatively) low-powered computer should be able to
run CQPweb with small-to-medium sized corpora; a modern desktop
system should also be fine with pretty large corpora – as should
most laptops as long as they have a big enough hard drive (see next
three paragraphs). As a general rule, having less-than-ideal hardware
will cause things to run slowly, rather than not run at all.</P>
<P LANG="en-GB">One potential bottleneck is working memory for big
database operations. For very intensive operation, MySQL requires
lots of memory; if it can't get enough RAM, it will use hard-disk
space as temporary storage instead; if it uses up all available
hard-disk space, it will fall over mid-operation, possibly with a
very uninformative error message (e.g. saying that it can't read from
a write to a particular temporary file). These “big database
operations” tend to be aspects of the corpus-setup procedure –
especially frequency-table creation – rather than anything that the
non-administrator user can set in motion. 
</P>
<P LANG="en-GB">How much disk space precisely MySQL might need for
some of CQPweb's big setup procedures is difficult to say for certain
– it depends, apart from anything else, on how far the MySQL daemon
can get just with RAM. However, as a rule of thumb, you should aim to
run CQPweb's MySQL database on a disk or partition which has free
space equal to a <I>multiple</I> of the raw-text size of the corpus
you are working with. (This will also be more than enough for cache
space and CWB-indexing of your corpus, if the cache and data
directories are on the same disk or partition.)</P>
<P LANG="en-GB">For example, on one of the CQPweb development
machines – a relatively modern server with plenty of RAM – MySQL
needed approximately 4 GB of temporary disk space for the process of
building frequency tables for a corpus whose raw text took up 1 GB.
So if you are regularly dealing with corpora of that size (on the
order of 100,000,000 words), it is a good idea to have, say, ten
times as much space available as your raw text takes up.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up PHP</B></FONT></FONT></P>
<P LANG="en-GB"><SPAN LANG="en-GB">CQPweb crucially requires the
</SPAN><SPAN LANG="en-GB"><B>mysql</B></SPAN><SPAN LANG="en-GB">
extension to PHP, which enables interaction between PHP and the MySQL
database software (note: </SPAN><SPAN LANG="en-GB"><I>not</I></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">the </SPAN></SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><B>mysqli</B></SPAN></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">extension</SPAN></SPAN></SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">,
which is something different). In PHP v5.x, this extension is not
enabled by default. See <A HREF="http://php.net/manual/en/mysql.installation.php">here</A>
for information on making sure it is enabled. You may have recompile
PHP to make the </SPAN></SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><B>mysql</B></SPAN></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">extension
available. </SPAN></SPAN><FONT COLOR="#0000ff"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><B>(We
are working on an extension to CQPweb which will make worrying about
the availability of mysql unnecessary by allowing the system to work
equally well with both </B></SPAN></SPAN></FONT><FONT COLOR="#0000ff"><SPAN LANG="en-GB"><I><B>mysql</B></I></SPAN></FONT><FONT COLOR="#0000ff"><SPAN LANG="en-GB">
</SPAN></FONT><FONT COLOR="#0000ff"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><B>and
</B></SPAN></SPAN></FONT><FONT COLOR="#0000ff"><SPAN LANG="en-GB"><I><B>mysqli</B></I></SPAN></FONT><FONT COLOR="#0000ff"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><B>.)</B></SPAN></SPAN></FONT></P>
<P LANG="en-GB"><SPAN LANG="en-GB">Certain aspects of he behaviour of
PHP is controlled by its </SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">php.ini</SPAN></FONT><SPAN LANG="en-GB">
file (see <A HREF="http://www.php.net/manual/en/ini.php">here</A>).
The precise settings in this file may be different depending on how
you installed PHP (or your system administrator may have subsequently
adjusted them). Most of them will not affect CQPweb. However, four
directives set limits on PHP's use of system resources, and CQPweb
has been written on the assumption that these directives are set to
at least moderately generous values; if your system's settings are
much less than these, you may have problems. The directives in
question are as follows:</SPAN></P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">upload_max_file_size</SPAN></FONT>
	needs to be quite high if you want to upload corpus files to index
	over HTTP; we recommend <FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">20M</SPAN></FONT>
	(for files larger than that relying on HTTP is probably a bad idea
	anyway)</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">post_max_size</SPAN></FONT>
	needs to be at least as high as <FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">upload_max_file_size
	</SPAN></FONT>
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">memory_limit</SPAN></FONT>
	should be moderately generous as some CQPweb operations are
	RAM-intensive (e.g. loading entire files into memory); we suggest
	<FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">25M</SPAN></FONT>
		</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">max_execution_time</SPAN></FONT>
	should be generous as well; we suggest <FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">60</SPAN></FONT>
		</P>
</UL>
<P LANG="en-GB">Less “generous” limits for file size, memory use,
and execution time may be OK if you are running CQPweb on a
standalone computer rather than a shared web server. Once CQPweb is
up and running, the values of these settings can be checked by
looking at “PHP configuration” in the Admin control panel. You
can also find out the location of the active <FONT FACE="Courier New, monospace">php.ini</FONT>
file from this screen.</P>
<P LANG="en-GB"><SPAN LANG="en-GB">Finally, <A HREF="http://php.net/manual/en/features.safe-mode.php">PHP
has a “safe-mode” configuration</A>. This should, ideally, </SPAN><SPAN LANG="en-GB"><I>not</I></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">be
activated; if it is, you may well find that some CQPweb operations do
not work. </SPAN></SPAN>
</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">PHP safe mode
	may not allow CQPweb to run CQP and Perl as separate child processes
	if the </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">cqp</SPAN></FONT>
	<SPAN STYLE="font-style: normal">and </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">perl</SPAN></FONT>
	<SPAN STYLE="font-style: normal">executables are not in its “safe”
	directories – in which case, </SPAN><I>nothing</I> <SPAN STYLE="font-style: normal">will
	work.</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">PHP safe-mode
	will </SPAN><FONT COLOR="#000000"><FONT FACE="Times New Roman"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">stop
	CQPweb from lifting</SPAN></SPAN></FONT></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><FONT FACE="Times New Roman"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">restrictions
	on execution time for long-running operations; these functions
	(mostly setup functions for big corpora, but also processes like
	collocations on queries with lots of results) will stop working. </SPAN></SPAN></FONT></FONT>
	</P>
	<LI><P LANG="en-GB"><FONT COLOR="#000000"><FONT FACE="Times New Roman"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">PHP
	safe-mode will restrict CQPweb to only</SPAN></SPAN></FONT></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><FONT FACE="Times New Roman"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">opening
	or modifying files that CQPweb has created itself. However, some
	operations need CQPweb to work with files which it didn’t create
	itself but were, rather, created by the MySQL server or manually by
	you.</SPAN></SPAN></FONT></FONT></P>
</UL>
<P LANG="en-GB" STYLE="font-style: normal; font-weight: normal"><FONT COLOR="#000000"><FONT FACE="Times New Roman">Note
that the “safe-mode” feature of PHP has, in any case, been
deprecated as of recent versions (5.3.0 or later) of PHP – so web
servers should ideally not be relying on it anyway.</FONT></FONT></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up Apache</B></FONT></FONT></P>
<P LANG="en-GB">This section assumes that you are using Apache and
that you want to use the internal username/password functions in
CQPweb. If this assumption is false, skip onwards to the next
section!</P>
<P LANG="en-GB">Make sure that your Apache configuration file is set
up to allow <B>.htaccess</B> files in the CQPweb web-directory. The
directive 
</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AllowOverride
None</B></FONT></FONT></FONT></P>
<P LANG="en-GB" ALIGN=LEFT>sometimes appears by default in Apache
config files. Change it to</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AllowOverride
All</B></FONT></FONT></FONT></P>
<P LANG="en-GB"><I>for the site or directory which contains the
CQPweb web-directory</I>. Depending on how your Apache config files
are set up, this might be set overall for the server (in some
location like <FONT FACE="Courier New, monospace">/etc/apache2/apache2.conf</FONT>);
or for the particular host (in something like
<FONT FACE="Courier New, monospace">/etc/apache2/sites-available/{$site}.conf
</FONT>).</P>
<P LANG="en-GB">Note that if you change an Apache configuration file,
you will need to restart Apache for the changes to have effect.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT COLOR="#000000"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up the Perl elements</B></FONT></FONT></FONT></P>
<P LANG="en-GB"><FONT COLOR="#000000">You will need to install the
base module of the CWB Perl API distribution. You can download a
release package from the links to be found here:</FONT></P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB"><A HREF="http://cwb.sourceforge.net/download.php#perl"><FONT COLOR="#000000"><SPAN LANG="en-GB">http://cwb.sourceforge.net/download.php#perl</SPAN></FONT></A></P>
	<LI><P LANG="en-GB"><FONT COLOR="#000000"><I>You may wish to install
	other aspects of the CWB Perl API (CWB-CL, CWB-Web and CWB-CQi) but
	these are not needed just to run CQPweb.</I></FONT></P>
</UL>
<P LANG="en-GB"><FONT COLOR="#000000">The current releases are
version 2.2.102.</FONT></P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB"><FONT COLOR="#000000">Installation instructions
	are in the package's README file. </FONT>
	</P>
	<UL>
		<LI><P LANG="en-GB"><FONT COLOR="#000000">If you follow the
		standard instructions, the Perl module files will be copied into a
		directory on Perl's <FONT FACE="Courier New, monospace">@INC</FONT>
		path, such as <FONT FACE="Courier New, monospace">/usr/local/lib/perl/{$version}/</FONT>
		or <FONT FACE="Courier New, monospace">/usr/lib/perl5/{$version}/</FONT>
		, depending on the details of how Perl is set up on your system. </FONT>
		</P>
		<LI><P LANG="en-GB"><FONT COLOR="#000000"><I>If for any reason you
		wish to set up CQPweb to use a different Perl binary to your
		system's default (i.e. </I><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">which
		perl</SPAN></FONT><I>), you need to make sure the CWB modules are
		accessible to </I><I><U>that</U></I> <I>Perl binary</I>. <SPAN STYLE="font-style: normal">If
		you don't understand the previous sentences, ignore the preceding
		paragraph and this one!</SPAN></FONT></P>
		<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">If you install
		the Perl modules into a folder that is not in the normal Perl </SPAN><FONT COLOR="#000000"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">@INC</SPAN></FONT></FONT>
		<SPAN STYLE="font-style: normal">path (which you can do by
		specifying an alternative </SPAN><FONT COLOR="#000000"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">PREFIX</SPAN></FONT></FONT><SPAN STYLE="font-style: normal">),
		then you will need to tell CQPweb where they are. You can do this
		by setting the option </SPAN><FONT COLOR="#000000"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">$cwb_extra_perl_directories</SPAN></FONT></FONT>
		<SPAN STYLE="font-style: normal">in the configuration file (see
		below).</SPAN></P>
	</UL>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT COLOR="#000000"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up MySQL</B></FONT></FONT></FONT></P>
<P LANG="en-GB">You will need to create a new user and a new database
for CQPweb to use.</P>
<P LANG="en-GB">Make a note of the username / password of this new
user and of the new database.</P>
<P LANG="en-GB"><SPAN LANG="en-GB">The new database should have
</SPAN><SPAN LANG="en-GB"><B>default charset</B></SPAN><SPAN LANG="en-GB">
set to </SPAN><SPAN LANG="en-GB"><B>utf8.</B></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-weight: normal">This
addresses a bug which affects some (but not all!) versions of the
MySQL server software – see <A HREF="http://bugs.mysql.com/bug.php?id=10195">http://bugs.mysql.com/bug.php?id=10195</A></SPAN></SPAN></P>
<P LANG="en-GB">The new user needs to have <FONT FACE="Courier New, monospace">GRANT
ALL</FONT> on the new database. If you want MySQL to use file-access
functions (this is not necessary, but may speed things up; see
below), the new user also needs <FONT FACE="Courier New, monospace">GRANT
FILE ON *.*</FONT></P>
<P LANG="en-GB">Also make a note of the server-name needed to access
the MySQL server by a webscript. This will probably be <FONT FACE="Courier New, monospace">localhost</FONT>,
assuming that the MySQL server is on the same machine as the
webscripts. (It does not absolutely need to be.)</P>
<P LANG="en-GB">A known “gotcha”: PHP needs to know how to
connect to the MySQL server via a <I>socket</I> in the filesystem.
This information is often contained in the <FONT FACE="Courier New, monospace">php.ini</FONT>
file, which contains settings loaded by PHP when it starts up. On
many systems, connecting to MySQL simply “works” by default, but
on some systems you may need to edit your <FONT FACE="Courier New, monospace">php.ini</FONT>
file to tell PHP where to find the socket, by changing the
<FONT FACE="Courier New, monospace">mysql.default_socket</FONT>
setting. For instance, if your socket is at <FONT FACE="Courier New, monospace">/tmp/mysql.sock
</FONT>but PHP is looking at <FONT FACE="Courier New, monospace">/var/mysql/mysql.sock</FONT>
, you need to adjust <FONT FACE="Courier New, monospace">mysql.default_socket</FONT>
to /tmp/mysql.sock. If you edit a <FONT FACE="Courier New, monospace">php.ini</FONT>
file, make sure it is the one used when PHP is run by the server
(i.e. as CGI or as an Apache module).</P>
<P LANG="en-GB"><SPAN LANG="en-GB">Another potential problem can
arise from <A HREF="http://dev.mysql.com/doc/refman/5.5/en/binary-log.html">MySQL
binary logging</A>. Even relatively light use of a CQPweb
installation will make MySQL create very large binary log files,
ultimately using up all your disk space over time, if binary logging
is enabled. For this reason, it's recommended that you </SPAN><SPAN LANG="en-GB"><I>disable</I></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">binary
logging on the MySQL server that will be driving CQPweb. You can
<A HREF="http://dev.mysql.com/doc/refman/5.5/en/replication-options-binary-log.html">disable
binary logging</A> by commenting out or deleting the line containing
</SPAN></SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">log_bin</SPAN></SPAN></FONT><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">command in
the MySQL configuration file, or removing the equivalent
</SPAN></SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">--log-bin[=base_name]</SPAN></SPAN></FONT><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">directive
from the command line that starts up </SPAN></SPAN><SPAN LANG="en-GB"><I>mysqld.</I></SPAN><SPAN LANG="en-GB">
</SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">(In either
case you'll need to restart </SPAN></SPAN><SPAN LANG="en-GB"><I>mysqld</I></SPAN><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal">.)</SPAN></SPAN></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up directories</B></FONT></FONT></P>
<P LANG="en-GB">CQPweb needs the following directories to be created
on the server.</P>
<TABLE WIDTH=882 CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=556>
	<COL WIDTH=309>
	<TR VALIGN=TOP>
		<TD WIDTH=556 BGCOLOR="#c0c0c0" STYLE="border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0.11cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><B>Create
			a directory for…</B></FONT></FONT></FONT></P>
		</TD>
		<TD WIDTH=309 BGCOLOR="#c0c0c0" STYLE="border: 1.00pt solid #000000; padding: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><B>Where
			it should be</B></FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>The
				actual web scripts<BR>(NB the URL of this directory will become
				the base URL for your CQPweb system) </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			in the web-docs directory of the server</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL START=2>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>CQPweb’s
				web usernames and passwords </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL START=3>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Temporary
				files (inc the cache) </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL START=4>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Indexed
				corpora </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL START=5>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Registry
				files for indexed corpora </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=556 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0cm">
			<OL START=6>
				<LI><P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
				<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Upload
				area for files put onto the server via HTTP </FONT></FONT></FONT>
				</P>
			</OL>
		</TD>
		<TD WIDTH=309 STYLE="; border-top: none; border-bottom: 1.00pt solid #000000; border-left: 1.00pt solid #000000; border-right: 1.00pt solid #000000; padding-top: 0cm; padding-bottom: 0.11cm; padding-left: 0.11cm; padding-right: 0.11cm">
			<P LANG="en-GB" ALIGN=LEFT STYLE="border: none; padding: 0cm; font-style: normal; font-weight: normal; text-decoration: none">
			<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>Somewhere
			outside the web directory</FONT></FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB">… <SPAN LANG="en-GB">make a note of the path of
each one. </SPAN>
</P>
<P LANG="en-GB">Note that the data / registry locations do not need
to be the same as the ones you normally use for CWB.</P>
<P LANG="en-GB">The username of the webserver (in the case of Apache,
usually something like <B>www</B> or <B>www-data</B>) need to have
read-write-execute access to all these directories. The username of
the mysqld process (usually something like <B>mysql</B><SPAN STYLE="font-weight: normal">)
also needs read and write access if you want MySQL to use file-access
functions. So, these new folders </SPAN><I><SPAN STYLE="font-weight: normal">must</SPAN></I>
<SPAN STYLE="font-weight: normal">have the write permission set for
either “all” or – if you are worried about security – for
“group” (where the file is assigned to some group that both the
mysql server's account and the web server's account belong to).</SPAN></P>
<P LANG="en-GB"><I><SPAN STYLE="font-weight: normal">Sidenote for
Unix novices</SPAN></I><SPAN STYLE="font-weight: normal">: the easy
way to find out what the username of these two server programs is
with commands like these – the first word on the output line is the
username you want</SPAN></P>
<UL>
	<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">ps
	-e -o user,comm | grep mysqld </FONT>
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">ps
	-e -o user,comm | grep apache2 </SPAN><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">or
	whatever the name of the web server program is</SPAN></FONT></FONT></P>
</UL>
<P LANG="en-GB"><FONT FACE="Courier New, monospace"><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">A
“gotcha” can occur here in systems that have AppArmor (for
example, recent versions of Ubuntu). AppArmor allows/disallows file
access to individual programs; if it does not allow mysqld access to
these new directories, you will not be able to run CQPweb
successfully, </SPAN></FONT><FONT FACE="Times New Roman, serif"><I><SPAN STYLE="font-weight: normal">even
if</SPAN></I></FONT> <FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">the
</SPAN></FONT><FONT FACE="Times New Roman, serif"><B>mysql</B></FONT>
<FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">username
has full permissions. You fix this by doing the following (as root):</SPAN></FONT></FONT></P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">edit
	</SPAN></FONT><SPAN STYLE="font-weight: normal">/etc/apparmor.d/usr.sbin.mysqld</SPAN>
	<FONT FACE="Times New Roman, serif"><SPAN STYLE="font-weight: normal">and
	add a line like this before the closing brace for each CQPweb
	directory:</SPAN></FONT></FONT></P>
	<UL>
		<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">/path/to/the/directory/in/question/**
		rw,</FONT></P>
	</UL>
	<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Times New Roman, serif">Then
	restart AppArmor:</FONT></P>
	<UL>
		<LI><P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Courier New, monospace">/etc/init.d/apparmor
		restart</FONT></P>
	</UL>
</UL>
<P LANG="en-GB" STYLE="font-weight: normal"><FONT FACE="Times New Roman, serif">The
alternative is to disable AppArmor completely.</FONT></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up the web scripts</B></FONT></FONT></P>
<P LANG="en-GB">Copy the contents of the CQPweb <B>.tar.gz</B>
distribution file to the web directory you created above (such that
the directories <B>lib</B>, <B>adm</B> etc. appear directly within
this web-directory). Don’t change the folder hierarchy. Make sure
the www user has rwx access to all the files you’ve just put in
here.</P>
<P LANG="en-GB">Alternatively, use subversion to get the most
up-to-date version of the code:</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">svn co
	http://cwb.svn.sourceforge.net/viewvc/cwb/gui/cqpweb/trunk cqpweb</FONT></P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
a config file: automatically</B></FONT></FONT></P>
<P LANG="en-GB">There is now an auto-config script – it is somewhat
primitive but it will save you fiddling with PHP code for
configuration variables. To use it, change directory to the web
directory, and run</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">php
	cqpweb-autoconfig.php</FONT></P>
</UL>
<P LANG="en-GB">… <SPAN LANG="en-GB">and follow the instructions to
enter the paths and other info that you made a note of above.</SPAN></P>
<P LANG="en-GB">When you are asked to specify admin usernames, enter
at least one username (the one you will use). Its password is
initially set to the same as the username, you should change this as
soon as possible.</P>
<P LANG="en-GB">Note that the script's last action is to gzip itself
to avoid accidentally running again. Before you take the system live,
you should <B>delete this script</B> – <SPAN STYLE="font-weight: normal">as
it could compromise the security of the system. (When you use the
“restore default system security” option (see below), one of the
various things it does is check that this script is gone – in both
its gzipped and non-gzipped forms – and delete it if not.)</SPAN></P>
<P LANG="en-GB"><SPAN STYLE="font-weight: normal">You may wish to
change the configuration variables at some later point. If so, you
need to edit the file </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">config.inc.php</SPAN></FONT>
<SPAN STYLE="font-weight: normal">in the </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">lib</SPAN></FONT>
<SPAN STYLE="font-weight: normal">subdirectory of the web directory.
See the following section for some information on what you can change
manually in the config file. The core configuration variables </SPAN><I><SPAN STYLE="font-weight: normal">cannot
be changed through the web interface</SPAN></I><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">,
even if you are logged on as a superuser. This is for security
reasons.</SPAN></SPAN></P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
a config file: manually</B></FONT></FONT></P>
<P LANG="en-GB">If you configure CQPweb manually, you need to
actually edit the code file that contains the config variables. Do
this as follows: 
</P>
<P LANG="en-GB">Find the file called “template.config.inc.php”
and edit it. It looks like this:</P>
<TABLE WIDTH=1012 CELLPADDING=4 CELLSPACING=3>
	<COL WIDTH=996>
	<TR>
		<TD WIDTH=996 VALIGN=TOP STYLE="border: 2.60pt double #808080; padding: 0.11cm">
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>&lt;?php</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			SYSTEM CONFIG SETTINGS : the same for every corpus, and CANNOT be
			overridden */<BR>/* these settings should never be alterable from
			within CQPweb (would risk transmitting them as plaintext) */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			adminstrators' usernames, separated by | (as in BNCweb) */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$superuser_username
			= 'bob|jill';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			mySQL username and password */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_webuser
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_webpass
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_schema
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$mysql_server
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			---------------------- */<BR>/* server directory paths */<BR>/*
			---------------------- */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_cwb
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_apache_utils
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_perl
			= '';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_tempdir
			= '3';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_accessdir
			= '2';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cqpweb_uploaddir
			= '6';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cwb_datadir
			= '4';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$cwb_registry
			= '5';</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><BR><BR>
			</P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>/*
			if mySQL returns ???? instead of proper UTF-8 symbols, change this
			setting true -&gt; false or false -&gt; true */</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$utf8_set_required
			= true;</FONT></FONT></P>
			<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>?&gt;</FONT></FONT></P>
		</TD>
	</TR>
</TABLE>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$superuser_username</FONT>
variable is a string that should contain the usernames who are to be
administrators, separated by the pipe <FONT FACE="Courier New, monospace">|</FONT>.
You can have as many superusers as you like, but you must have at
least one.</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$mysql_</FONT>
settings are the things you noted when creating the mysql user.</P>
<P LANG="en-GB">The last five settings are the directories you
created (<I><B>numbers shown in the example correspond to the table
above</B></I>).</P>
<P LANG="en-GB">The <FONT FACE="Courier New, monospace">$path_to</FONT>
settings specify where the perl, cwb and apache utilities binaries
are to be found. This allows you to specify binaries that are not in
the system search-path for executables (e.g. if you want to use a
different version of Perl or CWB to the default on your system). Give
them in the following format (example paths from a linux server):</P>
<P LANG="en-GB" STYLE="border: none; padding: 0cm"><FONT FACE="Courier New"><FONT SIZE=2>$path_to_cwb
= 'usr/local/bin';<BR>$path_to_apache_utils =
'usr/local/bin';<BR>$path_to_perl = 'usr/bin';</FONT></FONT></P>
<P LANG="en-GB">Note in particular: there IS NOT a slash at the
beginning or end of any of these three paths.</P>
<P LANG="en-GB">You are recommended to start with <FONT FACE="Courier New"><FONT SIZE=2><SPAN LANG="en-US">$utf8_set_required
= true;</SPAN></FONT></FONT> and see if it causes a problem – and
change it if so.</P>
<P LANG="en-GB">There are assorted settings that can be set manually,
but not automatically. For most CQPweb setups, they can be safely
ignored if you don't understand exactly what they're for. They are</P>
<UL>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$use_corpus_categories_on_homepage</FONT>
	– this defaults to <B>false,</B> if you set it to <B>true</B> <SPAN STYLE="font-weight: normal">then
	the main menu of corpora will be given as a set of lists according
	to the corpus category, rather than as a single long list of
	corpora.</SPAN></P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">$create_password_function</SPAN></FONT>
	– <SPAN STYLE="font-weight: normal">CQPweb uses “suggest
	password” functions to ease the creation of user accounts. The
	default function (</SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">password_insert_internal</SPAN></FONT><SPAN STYLE="font-weight: normal">)
	produces passwords of the form </SPAN><B>aaaaddaaaa</B> <SPAN STYLE="font-weight: normal">where
	</SPAN><B>a</B> <SPAN STYLE="font-weight: normal">is a lowercase
	letter and </SPAN><B>d</B> <SPAN STYLE="font-weight: normal">is a
	digit. You can optionally use Lancaster University's web-based
	random password generator to get nicer, more-wordlike passwords: to
	do this, set the </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">$create_password_function</SPAN></FONT>
	<SPAN STYLE="font-weight: normal">to the quoted string
	</SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-weight: normal">'password_insert_lancaster'</SPAN></FONT><SPAN STYLE="font-weight: normal">.
	This will probably not work if your system needs to use a proxy
	server to access the web, however.</SPAN></P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$mysql_has_file_access</FONT>
	– this defaults to false, if you set it to true then this affects
	various functions that load data from file to the MySQL server: they
	may run faster. But this must only be set to true <B>if</B> (a) the
	MySQL server is running on the same computer as CQPweb <B>and</B>
	(b) the MySQL server actually does have access to the temporary
	directory and all other locations that CQPweb writes files to <B>and</B>
	(c) the MySQL username used by CQPweb has <FONT FACE="Courier New, monospace">GRANT
	FILE ON *.*</FONT> permissions. It is important you get this right,
	as CQPweb doesn't check these preconditions for you! 
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$cqpweb_uses_apache</FONT>
	– this defaults to true, but you can set it to false if your web
	server is not Apache. If it is set to false, functions that depend
	on Apache will be hidden (since they wouldn't work anyway).</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">$cqpweb_root_url</SPAN></FONT><SPAN LANG="en-GB">
	– you can set this to an absolute URL (in the style
	&quot;</SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">http://your-server.net/path/to/cqpweb/web/directory/</SPAN></FONT><SPAN LANG="en-GB">&quot;
	) and this will be used internally when CQPweb redirects the user's
	browser from one point in the system to another. If you don't set
	it, then CQPweb will try to work out its own URL based on
	information in PHP's global </SPAN><A HREF="http://php.net/_SERVER"><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">$_SERVER</SPAN></FONT></A><SPAN LANG="en-GB">
	array. This may produce incorrect results if you are running CQPweb
	in an environment where there is a lot of server proxying. </SPAN>
	</P>
	<LI><P LANG="en-GB"><FONT FACE="Courier New, monospace">$cwb_max_ram_usage</FONT>
	and <FONT FACE="Courier New, monospace">$cwb_max_ram_usage_cli</FONT>
	– some CWB programs allow a RAM usage limit to be set on their
	activities. When CQPweb calls these programs, it sets the RAM limit
	to the number of megabytes specified in these two variables (the
	first applies if CQPweb is called over the web, the second if it is
	called from the command-line). They default to 50Mb and 1000Mb
	respectively.</P>
	<LI><P LANG="en-GB"><FONT COLOR="#000000"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">$cwb_extra_perl_directories</SPAN></FONT></FONT>
	– if this is set, it should take the form of a quoted string that
	lists directories that you wish Perl to use as library directories
	when called by CQPweb, with individual directory paths separated by
	the pipe symbol (e.g. <FONT COLOR="#000000"><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">&quot;/extra/directory/1|/extra/directory/2&quot;</SPAN></FONT></FONT>.
	All paths must be <I>absolute</I><SPAN STYLE="font-style: normal">.
	Normally, the only reason to use this variable is to specify a
	non-standard location for the installed CWB-Perl modules (see above)
	thus – the name of the setting. The directories in question will
	be passed to Perl using the </SPAN><FONT FACE="Courier New, monospace"><SPAN STYLE="font-style: normal">-I</SPAN></FONT>
	<SPAN STYLE="font-style: normal">command-line option.</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$css_path_for_homepage
	– this should be a relative or absolute URL of a stylesheet to use
	for the main menu page. By default, a lovely blue-and-grey table
	effect is used.</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$css_path_for_adminpage
	– this should be a relative or absolute URL of a stylesheet to use
	for the admin control panel page. By default, a red-and-pink colour
	scheme.</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$print_debug_messages
	– this default to false, if you set it to true messages about what
	is going on behind the scenes will appear all over various CQPweb
	pages.</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$cache_size_limit
	– defaults to 3 gigabytes, the amount of data that will be cached
	(CQP temporary files only). Note that until the cache limit is
	reached, the cache will just keep growing!</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$default_max_fullsize_dbs_in_cache</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$default_max_dbsize</SPAN></P>
	<LI><P LANG="en-GB"><SPAN STYLE="font-style: normal">$default_mysql_process_limit
	– this defaults to five, represents the number of </SPAN><I>big</I><SPAN STYLE="font-style: normal">
	MySQL processes that will be run at once.</SPAN></P>
	<LI><P LANG="en-GB"><FONT COLOR="#0047ff"><SPAN STYLE="font-style: normal">&lt;NB,
	these settings should be filed under various headings for
	clarity...&gt;</SPAN></FONT></P>
</UL>
<P LANG="en-GB">Save the edited file as “config.inc.php” and put
it into the “lib” subdirectory of the web directory.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Setting
up administrator users</B></FONT></FONT></P>
<P LANG="en-GB"><I><U>If you have used the autoconfig, then this is
done automatically for you.</U></I> Otherwise, you need to manually
set up the administrator accounts <I>simply in order to get into
CQPweb</I> to complete the rest of the setup procedure...</P>
<P LANG="en-GB">Using a text editor, create a file called <B>.htgroup</B>
in directory (2) as described above. It should look like this:</P>
<P LANG="en-GB" ALIGN=LEFT><FONT FACE="Courier New"><B>superusers:
bob jill</B></FONT></P>
<P LANG="en-GB">but with the usernames changed to match the ones in
your configuration file.</P>
<P LANG="en-GB">Now, use the Apache htpasswd utility to actually
create these user accounts, with the following commands:</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>htpasswd
-bc /</B></FONT></FONT></FONT><FONT COLOR="#800000"><FONT FACE="Courier New"><FONT SIZE=3><B>$cqpweb_accessdir</B></FONT></FONT></FONT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>/.htpasswd
bob bobspassword<BR>htpasswd -b /</B></FONT></FONT></FONT><FONT COLOR="#800000"><FONT FACE="Courier New"><FONT SIZE=3><B>$cqpweb_accessdir</B></FONT></FONT></FONT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>/.htpasswd
jill jillspassword</B></FONT></FONT></FONT></P>
<P LANG="en-GB">… <SPAN LANG="en-GB">where </SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">$cqpweb_accessdir</SPAN></FONT><SPAN LANG="en-GB">
is directory (2) above (if you </SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">cd</SPAN></FONT><SPAN LANG="en-GB">
to the directory in question, you can just use the </SPAN><FONT FACE="Courier New, monospace"><SPAN LANG="en-GB">.htpasswd</SPAN></FONT><SPAN LANG="en-GB">
filename, of course). </SPAN>
</P>
<P LANG="en-GB">You'll also need to create a <B>.htaccess</B> file
for the <B>./adm</B> directory. It should look like this:</P>
<P LANG="en-GB" ALIGN=LEFT><FONT COLOR="#000000"><FONT FACE="Courier New"><FONT SIZE=3><B>AuthUserFile
/<FONT COLOR="#800000">$cqpweb_accessdir</FONT>/.htpasswd<BR>AuthGroupFile
/<FONT COLOR="#800000">$cqpweb_accessdir</FONT>/.htgroup<BR>AuthName
CQPweb<BR>AuthType Basic<BR>deny from all<BR>require group
superusers<BR>satisfy any</B></FONT></FONT></FONT></P>
<P LANG="en-GB">… <SPAN LANG="en-GB">but with the appropriate
directories substituted, as in the configuration file.</SPAN></P>
<P LANG="en-GB">Once CQPweb is up and running, you can use the
“create user / reset password” function to change superuser
account passwords if necessary.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Getting
it up and running</B></FONT></FONT></P>
<P LANG="en-GB">You are now ready to go. Open a web browser and
navigate to 
</P>
<P LANG="en-GB"><FONT FACE="Courier New, monospace"><B>http://your-server.net/path/to/cqpweb/web/directory/adm</B></FONT></P>
<P LANG="en-GB">(the “adm” is short for Admin).</P>
<P LANG="en-GB">You should see an admin menu. 
</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “manage users”. Set secure
	passwords for AT LEAST the superusers (<I><B>if you used the
	autoconfig script, superuser passwords have been set to the same as
	the usernames</B></I>). You can add other user accounts later. 
	</P>
	<LI><P LANG="en-GB">Click on “Reset MySQL Database” – and do
	it 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “System security” – and restore
	default security. (Only do this if you are using Apache) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Click on “Skins and colours” – and
	“Regenerate colour schemes” 
	</P>
	<LI><P LANG="en-GB">Click on “Mapping tables” – and
	“Regenerate built-in mapping tables”</P>
</UL>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Creating
usernames</B></FONT></FONT></P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Use “manage users” for this.</P>
	<LI><P LANG="en-GB">CQPweb gives access to corpora to groups of
	users, not individual usernames. This is done through the “manage
	access” link for each corpus: find this on the “show corpora”
	item of the admin menu.</P>
	<LI><P LANG="en-GB">A user can be assigned to as many groups as you
	like. Use “Manage groups” for this. 
	</P>
</UL>
<P LANG="en-GB">If you're using a normal web server, CQPweb passwords
are transmitted in plaintext via HTTP. <B>User accounts are thus not
secure</B>, the security is all based on the fact that even if
someone manages to hack in, they can’t do anything other than break
CQPweb itself. For this reason, I usually select passwords for my
users, to make sure that they don’t re-use on CQPweb the secure
passwords that they use for other purposes. If you really want secure
username/password access, you need to set up CQPweb on an HTTPS
server.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Installing
a corpus <FONT COLOR="#0000ff">[TODO: expand this to a separate
document]</FONT></B></FONT></FONT></P>
<P LANG="en-GB">Corpora must follow all the usual rules for CWB
corpora and in addition there is the following requirement:</P>
<P LANG="en-GB">Every text in the corpus must begin with</P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">&lt;text
id=&quot;XXX&quot;&gt;</FONT></P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">...</FONT></P>
<P LANG="en-GB">and end with</P>
<P LANG="en-GB" STYLE="margin-left: 1.25cm"><FONT FACE="Courier New, monospace">&lt;/text&gt;</FONT></P>
<P LANG="en-GB">and there must be at least one of these “text”
elements (ie if the whole corpus is one text you still need these XML
bits at the start and finish).</P>
<P LANG="en-GB">The XXX id-codes must be C / Unix words – i.e. made
up only of the letters A to Z, a to z, the numbers 0 to 9, and the
underscore (with an underscore or letter in the first position). This
is because they are used as “handles” by the system to refer to
different texts. So no spaces or punctuation (except underscore) are
allowed.</P>
<P LANG="en-GB">To install a corpus, you need:</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">A file or files containing the corpus text, as
	above 
	</P>
	<LI><P LANG="en-GB">A file of corpus metadata. 
	</P>
</UL>
<P LANG="en-GB"><FONT COLOR="#0000ff"><B>[Add note here about maximum
corpus size: 32 bit versus 64 bit – make this visible in the CQPweb
admin view]</B></FONT></P>
<P LANG="en-GB">The metadata file should be a tab-delimited database.
The first column should be the text id-codes, with a line for each
text. You can then have as many columns of metadata as you need.</P>
<P LANG="en-GB">Metadata is of two sorts – classifications and free
text</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Free text – for items where the metadata can
	vary across every single text (e.g. text title) 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Classifications – for items where each text
	falls into one of a limited number of categories (e.g. written vs
	spoken) In this case the field values must be handles (Unix words as
	described above), NOT multi-word explanations 
	</P>
</UL>
<P LANG="en-GB">All files must be either ASCII or UTF-8. If they are
UTF-8, the file must <U><B>not</B></U> have a leading byte-order
mark. Linebreaks should be \n , not \r or \r\n .</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Upload all your files (text + metadata) to the
	upload area (directory 6). Then go to “Install new corpus” in
	the web admin interface. This form is pretty self-explanatory if you
	know CWB, but note the following: 
	</P>
	<LI><P LANG="en-GB"><FONT COLOR="#ff0000"><B>There is a bug in
	CQPweb just now that creates problems if the MySQL name and the CWB
	name are not the same. Again, these are handles, so use Unix words
	</B><SPAN STYLE="font-weight: normal">(and both must be
	all-lowercase)</SPAN><B>. </B></FONT>
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">The following names cannot be used for installed
	corpora, as they are the names of subdirectories that contain the
	internal workings of CQPweb: <B>adm, css, doc, lib</B><SPAN STYLE="font-weight: normal">.
	Any additional subdirectories we add in the future will be
	three-letter-names as well. So to be future-proof, use four or more
	letters/numbers in names for corpora.</SPAN></P>
	<LI><P LANG="en-GB">CQPweb’s default P-attribute setup assumes
	texts have Lancaster University's default annotation set, encoded
	like the BNC (a future version of this documentation will contain
	more details and examples). But you can use any number or kind of
	tags, or none. If you have annotations you need to set one as
	primary – this would usually be POS tag. 
	</P>
</UL>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">Again each annotation column must have a Unix
	word as its handle. 
	</P>
	<UL>
		<LI><P LANG="en-GB">After your corpus is installed, you will need
		to set up the interaction with CEQL on the “Manage annotation”
		page – where annotations are referred to using these handles. See
		below</P>
	</UL>
</UL>
<P LANG="en-GB">When you have installed your corpus, you will need to
fill in a form describing the metadata table, which is then loaded.
Each field must have a handle, and you must specify whether it is a
classification or not.</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">At the bottom of the form are two alternative
	methods: create a “dummy” table if there is no metadata, and use
	information indexed in the XML of the corpus to create the metadata
	table (this has a similar form to fill in).</P>
	<LI><P LANG="en-GB">You also need to decide whether or not you want
	to automatically run the frequency list setup. The best answer is
	<B>yes</B> <SPAN STYLE="font-weight: normal">for small corpora and
	</SPAN><B>no</B> <SPAN STYLE="font-weight: normal">for large
	corpora.</SPAN></P>
</UL>
<P LANG="en-GB">Once the metadata table is loaded, you will be on a
page called “<FONT COLOR="#000000"><FONT FACE="Times New Roman, serif"><FONT SIZE=3><SPAN STYLE="font-style: normal"><B>Admin
tools for managing corpus metadata</B></SPAN></FONT></FONT></FONT> ”.
If you didn't automatically setup frequency lists, you can now do so
using the first four buttons under “<B>Other metadata controls</B>”.
Or, for very big corpora, you may prefer to run the setup offline:
the command for this is <FONT FACE="Courier New, monospace">../lib/offline-freqlists.php</FONT>
and you must run it from within the web-directory that has been
created for your corpus. Ideally, you should run this script as the
web-user (see above), but if you run it under a different username,
make sure all the files it creates are read-and-writeable by the
web-user before going any further.</P>
<P LANG="en-GB">The next (optional) step is to set up the interaction
of your annotation with the CEQL Simple Query Parser. Click on
“Manage Annotation” for this. The primary annotation will already
be set up – it is accessed by putting the tag you want to search
for after an underscore in Simple Query (like POS tags in BNCweb).
But if you want to use CEQL to access other p-attributes, you need to
set this up here.</P>
<UL TYPE=DISC>
	<LI><P LANG="en-GB">The <B>secondary</B> annotation is just another
	column like the primary annotation, accessed in CEQL by putting what
	you want to search for in {braces}. Typically you'd put a “headword”
	i.e. lemma here.</P>
	<LI><P LANG="en-GB">The <B>tertiary</B> annotation is a bit
	different. It accesses a third field, via
	_{braces-with-leading-underscore}, but i<U>t also requires a mapping
	table</U> as it is possible to set up multiple aliases for a single
	tag. This is meant to support “simplified” POS tags like the
	Oxford Simplified Tagset used in the BNC. For example, the tag SUBST
	is used for nouns in the OST; but the aliases N and NOUN are set up
	for this tag in the mapping table – the idea being to make access
	to the simple tagsets more intuitive. Currently, mapping tables are
	built into the CQPweb code (in <FONT FACE="Courier New, monospace">ceql.inc.php</FONT>
	if you want to do some hacking).</P>
	<LI><P LANG="en-GB">The <B>combination</B> annotation is for a type
	of accelerated query. Due to the way CQP works, it is quicker to
	query one p-attribute than two, especially in very big corpora. So,
	to make the querying of lemma-plus-pos quicker, in BNC-style index
	formats an extra p-attribute is added, consisting of the headword
	(hw) and simple POS (class) attributes joined by an underscore. This
	combined p-attribute is called “lemma” in the terminology of BNC
	annotation.<BR><BR>If you have a combination attribute in your
	corpus like this, then identifying it here will allow you to access
	it via searches of the type {.../...}. If you <I>don't</I> have a
	combination annotation, then searches of this type will convert
	automatically to search the secondary and tertiary annotations at
	the same time: i.e. {aaa/bbb} becomes the same as {aaa}_{bbb} –
	<I><U>but note this back-up behaviour is currently buggy in the
	CQPweb implementation of CEQL</U></I>.<BR><BR>The second half of the
	combination annotation uses the same mapping table as the tertiary
	annotation.</P>
	<LI><P LANG="en-GB">Annotations that are not accessible via CEQL can
	still be accessed using the full CQP syntax.</P>
</UL>
<P LANG="en-GB">You are now ready to go – point your browser at
<B>http://your-server.net/path/to/cqpweb/web/directory</B> and you’re
off.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Using
CQPweb with a web server other than Apache</B></FONT></FONT></P>
<P LANG="en-GB">CQPweb can be used with web servers other than
Apache. However, you will not be able to use the internal
user-creation, group-management, and access-management functions,
because these are all dependent on Apache htaccess, htpasswd and
htgroup files (and the information is not stored in the database).
CQPweb on its own does nothing to restrict access to a corpus to
particular users: this job belongs to the web server. 
</P>
<P LANG="en-GB">CQPweb does store some information about users in its
database – notably, the “limits” of how big each individual use
of the database can be, and the personalisable “settings” that
affect the default behaviour of CQPweb. For both these purposes,
CQPweb gets the username from the HTTP request (PHP variable
<FONT FACE="Courier New, monospace">$_SERVER['REMOTE_USER']</FONT> ).
User entries in the database are created automatically when they
change their settings (or with default settings when any script
queries a user setting before they have been set.) So, any HTTP
server system that results in the username being part of the HTTP
request can be used with CQPweb.</P>
<P LANG="en-GB">CQPweb puts each corpus in a separate directory in
its root web-directory, so that you can set access rights for each
corpus separately, if you wish. But if you are not using Apache, <I>you
will have to manage this yourself</I>. 
</P>
<P LANG="en-GB">With Apache, this works as follows: (a) the
web-folder of each corpus has an <FONT FACE="Courier New, monospace">.htaccess</FONT>
file in which are listed the groups that have access to that corpus;
(b) the list of members in each group is in the .htgroup file in
CQPweb's “access” directory (and the <FONT FACE="Courier New, monospace">.htpasswd</FONT>
file is there as well). How exactly you simulate this will depend on
the details of the alternative web server you are using.</P>
<P LANG="en-GB"><BR><BR>
</P>
<P LANG="en-GB" STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Albany, sans-serif"><FONT SIZE=4><B>Using
a separate computer for MySQL </B></FONT></FONT>
</P>
<P LANG="en-GB">You might want to use two separate machines for the
CWB-based and MySQL-based parts of CQPweb, for reasons of performance
(for a big corpus and for queries with lots of results, both MySQL
and CWB require lots of disk space and lots of processing power). 
</P>
<P LANG="en-GB">In this case, CQPweb itself (the web scripts) should
be on the same system as CWB, and all the paths specified in the
config file should refer to <I>that</I> file-system, <I>not</I> the
one with MySQL on it.</P>
<P LANG="en-GB">You <I>must not</I> set <FONT FACE="Courier New, monospace">$mysql_has_file_access</FONT>
to <B>true</B> if the MySQL server is on a separate computer. The
system cannot currently check this for you!</P>
<P LANG="en-GB"><BR><BR>
</P>
<HR>
<P LANG="en-GB"><FONT COLOR="#808080"><FONT FACE="verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><SPAN LANG="en-GB"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">CQPweb
v2.13 © 2008-2010 – documentation by Andrew Hardie,
<A HREF="mailto:andrewhardie@user.ssourceforge.net">andrewhardie@users.sourceforge.net</A>
</SPAN></SPAN></SPAN></FONT></FONT></FONT>
</P>
</BODY>
</HTML>